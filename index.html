<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PROYECTO: BÓVEDA DIGITAL</title>
    <style>
        :root {
            --bg-color: #0A0A0A; --text-color: #FFB800; --accent-color: #00FFFF;
            --secondary-color: #606060; --error-color: #e64539; --font-terminal: 'Courier New', Courier, monospace;
        }
        * { margin: 0; padding: 0; box-sizing: border-box; }

        @keyframes scroll-background { from { background-position: 0 0; } to { background-position: -100px -100px; } }
        @keyframes pulse-glow { 0%, 100% { text-shadow: 0 0 5px var(--accent-color); box-shadow: 0 0 15px rgba(0, 255, 255, 0.5); } 50% { text-shadow: 0 0 15px var(--accent-color); box-shadow: 0 0 30px rgba(0, 255, 255, 0.8); } }
        @keyframes scan-line { from { top: -10%; opacity: 0; } 50% { top: 50%; opacity: 0.7; } to { top: 110%; opacity: 0; } }
        @keyframes glitch { 0% { transform: translate(0); opacity: 1; } 20%{transform: translate(-2px, 2px);} 40%{transform: translate(-2px, -2px);} 60%{transform: translate(2px, 2px);} 80%{transform: translate(2px, -2px);} 100% { transform: translate(0); opacity: 0; } }
        @keyframes pulse { 0% { transform: scale(0.9); opacity: 0; } 70% { transform: scale(1.05); opacity: 1; } 100% { transform: scale(1); opacity: 1; } }

        body {
            background-color: var(--bg-color); color: var(--text-color); font-family: var(--font-terminal);
            display: flex; justify-content: center; align-items: center; min-height: 100vh; overflow: hidden;
            text-shadow: 0 0 2px rgba(255,184,0,0.5);
            background-image: repeating-linear-gradient(rgba(96,96,96,0.1) 0 1px, transparent 1px 100px), repeating-linear-gradient(90deg, rgba(96,96,96,0.1) 0 1px, transparent 1px 100px);
            animation: scroll-background 30s linear infinite;
        }
        
        #app-container {
            width: 95vw; height: 95vh; max-width: 1200px; max-height: 800px;
            border: 2px solid var(--secondary-color); padding: 2vw; position: relative;
            display: flex; justify-content: center; align-items: center;
            background-color: rgba(10,10,10,0.85); backdrop-filter: blur(3px);
            transition: border 0.3s;
        }
        #app-container:fullscreen { border: none; }
        @media (min-width: 768px) { #app-container { aspect-ratio: 16 / 9; height: auto; padding: 1.5rem; } }
        
        .screen { width: 100%; height: 100%; position: absolute; top: 0; left: 0; display: flex; flex-direction: column; justify-content: center; align-items: center; opacity: 0; transition: opacity 0.5s ease-out; background: none; }
        .screen.visible { opacity: 1; z-index: 10; }
        .screen.glitch-out { animation: glitch 0.3s forwards; }

        .button-group { display: flex; flex-direction: column; gap: 1rem; margin-top: 2rem; align-items: center; width: 100%; }
        .primary-button, .secondary-button { padding: 0.8rem 1rem; font-family: var(--font-terminal); font-size: clamp(1rem, 2vw, 1.5rem); cursor: pointer; transition: all 0.3s; width: 80%; max-width: 450px; text-align: center; }
        .primary-button { color: var(--bg-color); background-color: var(--accent-color); border: 2px solid var(--accent-color); }
        .primary-button:hover { background-color: transparent; color: var(--accent-color); animation: pulse-glow 1.5s infinite; }
        .secondary-button { font-size: clamp(0.9rem, 1.5vw, 1.1rem); color: var(--secondary-color); background-color: transparent; border: 2px solid var(--secondary-color); }
        .secondary-button:hover { background-color: var(--secondary-color); color: var(--bg-color); }

        #profile-manager-screen, #leaderboard-screen { gap: 1rem; justify-content: flex-start; padding-top: 5vh; }
        #profile-manager-screen h1, #leaderboard-screen h1 { font-size: clamp(1.8rem, 3.5vw, 2.8rem); text-shadow: 0 0 10px var(--text-color); margin-bottom: 2vh; text-align: center; }
        .profile-list, .leaderboard-list { list-style: none; width: 90%; max-width: 600px; display: flex; flex-direction: column; gap: 1rem; text-align: center; }
        .leaderboard-list { font-size: clamp(1rem, 1.8vw, 1.4rem); }
        .leaderboard-list li { display: flex; justify-content: space-between; padding: 0.5rem; border: 1px solid var(--secondary-color); background: rgba(0,0,0,0.2); }
        .leaderboard-list span:first-child { margin-right: auto; text-align: left; overflow: hidden; text-overflow: ellipsis; white-space: nowrap; }
        .leaderboard-list span:last-child { color: var(--accent-color); padding-left: 1rem; }

        #verdict-screen { z-index: 20; text-align: center; }
        #verdict-message { font-size: clamp(1.5rem, 3vw, 2.2rem); animation: pulse 1s ease-in-out; letter-spacing: 2px; }
        #verdict-points { font-size: clamp(1.3rem, 2.5vw, 1.8rem); margin-top: 1rem; color: var(--accent-color); }
        .verdict-correct { color: var(--accent-color); text-shadow: 0 0 10px var(--accent-color); }
        .verdict-incorrect { color: var(--error-color); text-shadow: 0 0 10px var(--error-color); }

        #player-name-screen h2 { font-size: clamp(1.2rem, 2vw, 1.8rem); text-align: center; padding: 0 1rem; }
        #player-name-screen { gap: 2vh; } #name-display-container { width: 90%; height: 12%; border: 2px solid var(--secondary-color); padding: 1vh 2vw; display: flex; align-items: center; } #name-display { font-size: clamp(1.5rem, 3vw, 2.5rem); min-height: 1em; } #name-display .cursor { display: inline-block; background-color: var(--text-color); width: 0.5em; height: 1em; animation: blink-caret .8s step-end infinite; }
        #virtual-keyboard { width: 100%; height: 60%; max-height: 400px; display: flex; flex-direction: column; gap: 0.5vw; padding: 0 2%; } .keyboard-row { display: flex; width: 100%; height: 25%; gap: 0.5vw; } .key { display: flex; justify-content: center; align-items: center; font-family: var(--font-terminal); background-color: var(--secondary-color); color: var(--text-color); border: 1px solid var(--bg-color); font-size: clamp(1rem, 2vw, 1.5rem); cursor: pointer; transition: background-color 0.2s, transform 0.1s; aspect-ratio: 1 / 1; flex-grow: 1; user-select: none; } .key:active { transform: scale(0.95); } .key .case-up { display: none; } #virtual-keyboard.shift-active .case-down { display: none; } #virtual-keyboard.shift-active .case-up { display: block; } .key-special { flex-grow: 1.5; background-color: #404040; } .key-wide { flex-grow: 8; } .key-shift.active { background-color: var(--accent-color); color: var(--bg-color); }
        
        #category-hub-screen { justify-content: space-between; padding-top: 2vh; }
        #hub-header { width: 100%; display: flex; justify-content: space-between; align-items: center; padding: 0 1vw; }
        #hub-header h2 { font-size: clamp(1rem, 2vw, 1.5rem); text-align: left; overflow: hidden; text-overflow: ellipsis; white-space: nowrap; }
        .logout-button { font-size: clamp(0.8rem, 1vw, 0.9rem); padding: 0.4rem 0.8rem; }
        #category-grid { width: 100%; flex-grow: 1; display: grid; grid-template-columns: repeat(2, 1fr); grid-template-rows: repeat(4, 1fr); gap: 1.5vmin; padding: 2vh 1vw; } @media (min-width: 768px) { #category-grid { grid-template-columns: repeat(4, 1fr); grid-template-rows: repeat(2, 1fr); } } .category-card { position: relative; overflow: hidden; border: 2px solid var(--secondary-color); padding: 1vmin; display: flex; flex-direction: column; justify-content: space-between; align-items: center; text-align: center; cursor: pointer; transition: all 0.3s; } .category-card:hover::before { animation: scan-line 0.5s ease-out; } .category-card h3 { font-size: clamp(0.8rem, 1.4vw, 1.1rem); line-height: 1.2; } .progress-text { margin-top: 0.5vh; font-size: clamp(0.7rem, 1.3vw, 1rem); color: var(--secondary-color); } .progress-container { width: 80%; height: 1.2vh; background-color: #222; border: 1px solid var(--secondary-color); margin-top: auto; } .progress-bar { width: 0%; height: 100%; background-color: var(--accent-color); transition: width 0.5s ease-out; }
        
        #challenge-matrix-screen { justify-content: space-between; padding: 2vh 0; gap: 2vh; } #challenge-matrix-screen h2 { font-size: clamp(1.2rem, 2vw, 1.8rem); text-align: center; padding: 0 1rem; } #challenge-grid { width: 100%; height: 80%; display: grid; grid-template-columns: repeat(6, 1fr); grid-template-rows: repeat(5, 1fr); gap: 1.2vmin; padding: 0 5%; } .challenge-node { position: relative; overflow: hidden; border: 2px solid var(--secondary-color); background-color: transparent; font-family: var(--font-terminal); color: var(--secondary-color); font-size: clamp(1rem, 1.8vw, 1.5rem); cursor: pointer; transition: all 0.2s ease; display: flex; justify-content: center; align-items: center; } .challenge-node:hover:not(.status-correct)::before { animation: scan-line 0.5s ease-out; } .challenge-node.status-correct { background-color: var(--accent-color); border-color: var(--accent-color); color: var(--bg-color); cursor: default; } .challenge-node.status-incorrect { background-color: var(--secondary-color); border-color: var(--secondary-color); color: #333; text-decoration: line-through; } .back-button { padding: 0.5rem 1.5rem; font-family: var(--font-terminal); font-size: clamp(1rem, 1.2vw, 1.4rem); color: var(--secondary-color); background-color: transparent; border: 2px solid var(--secondary-color); cursor: pointer; transition: all 0.3s; } .back-button:hover { background-color: var(--secondary-color); color: var(--bg-color); }
        
        #game-interface-screen { justify-content: space-between; padding: 2vh 4vw; gap: 2vh; } #question-container { width: 100%; flex-grow: 1; border: 2px solid var(--secondary-color); padding: 2vmin; display: flex; justify-content: center; align-items: center; line-height: 1.4; } #question-text { font-size: clamp(1rem, 1.8vw, 1.5rem); text-align: center; } #options-container { width: 100%; height: 60%; display: grid; grid-template-columns: 1fr; grid-template-rows: repeat(4, 1fr); gap: 1.5vmin; } .option-button { background-color: transparent; border: 2px solid var(--secondary-color); font-family: var(--font-terminal); color: var(--text-color); font-size: clamp(0.9rem, 1.5vw, 1.2rem); cursor: pointer; transition: all 0.2s ease; display: flex; align-items: center; padding: 0 1.5vw; text-align: left; line-height: 1.3; } .option-button.selected { background-color: rgba(255, 184, 0, 0.2); } .option-button.correct { border-color: var(--accent-color); background-color: var(--accent-color); color: var(--bg-color); text-shadow: 0 0 5px var(--bg-color); } .option-button.incorrect { border-color: var(--error-color); background-color: var(--error-color); color: var(--secondary-color); }

        #review-screen { justify-content: space-around; padding: 3vh 2vw; gap: 1.5vh; }
        #review-screen h2 { font-size: clamp(1.5rem, 3vw, 2rem); color: var(--error-color); text-shadow: 0 0 10px var(--error-color); }
        .review-box { width: 95%; border: 1px solid var(--secondary-color); padding: 1.5vh 2vw; }
        .review-box h3 { font-size: clamp(1rem, 1.5vw, 1.2rem); color: var(--secondary-color); margin-bottom: 1vh; }
        .review-text { font-size: clamp(0.9rem, 1.6vw, 1.3rem); line-height: 1.4; }
        .review-option { display: flex; align-items: start; margin-top: 1vh; }
        .review-option-prefix { margin-right: 1vw; font-weight: bold; }
        .review-user-choice .review-option-prefix { color: var(--error-color); }
        .review-user-choice .review-text { color: var(--error-color); }
        .review-correct-choice .review-option-prefix { color: var(--accent-color); }
        .review-correct-choice .review-text { color: var(--accent-color); }
    </style>
</head>
<body>
    <div id="app-container"></div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            
            const appContainer = document.getElementById('app-container');
            const SAVE_KEY = 'PROJECT_DIGITAL_VAULT_SAVE';
            const TOTAL_QUESTIONS_PER_CAT = 30;

            const gameData = [
                { id: "cat01", title: "ERA PERFORADA Y MECÁNICA", questions: [{id:1,text:"¿Qué invención para telares fue precursora de la tarjeta perforada?",options:["Imprenta de Gutenberg","Telar de Jacquard","Motor a vapor","Teléfono"],correctIndex:1},{id:2,text:"¿Para qué evento masivo se usaron por primera vez las tarjetas perforadas de Hollerith?",options:["Exposición Universal 1889","Censo de EE.UU. 1890","Coronación Reina Victoria","Canal de Panamá"],correctIndex:1},{id:3,text:"En una tarjeta perforada, un agujero usualmente representaba un...",options:["Dato erróneo","Fin de archivo","Número o carácter ('1')","Espacio en blanco ('0')"],correctIndex:2},{id:4,text:"La ausencia de un agujero en una tarjeta perforada representaba un...",options:["Valor nulo","Cero o estado 'off'","Dato corrupto","La letra 'A'"],correctIndex:1},{id:5,text:"La máquina de Hollerith que leía tarjetas con agujas metálicas se llamaba...",options:["Calculadora Universal","Motor Analítico","Máquina Tabuladora","Secuenciador de datos"],correctIndex:2},{id:6,text:"¿Qué mega-corporación tecnológica surgió de la empresa de Herman Hollerith?",options:["Microsoft","Apple","Intel","IBM"],correctIndex:3},{id:7,text:"El mayor beneficio de la Máquina Tabuladora en el censo fue reducir drásticamente el...",options:["Costo del papel","Uso de electricidad","Tiempo de procesamiento","Número de errores"],correctIndex:2},{id:8,text:"¿De qué material principal estaban hechas las tarjetas perforadas?",options:["Plástico delgado","Lámina de aluminio","Cartulina rígida","Madera de balsa"],correctIndex:2},{id:9,text:"Charles Babbage concibió usar tarjetas perforadas para controlar su...",options:["Máquina Diferencial","Computadora ENIAC","Motor Analítico","Calculadora de Pascal"],correctIndex:2},{id:10,text:"Además de tarjetas, ¿qué otro medio usaba agujeros en papel?",options:["Disco magnético","Cinta de papel perforado","Cilindro de cera","Memoria de burbuja"],correctIndex:1},{id:11,text:"El estándar de tarjeta perforada de IBM de 1928 tenía un formato de...",options:["90 columnas, 10 filas","80 columnas, 12 filas","60 columnas, 20 filas","100 columnas, 8 filas"],correctIndex:1},{id:12,text:"En las tabuladoras, un 'plugboard' o panel de control se usaba para...",options:["Ajustar el brillo","Programar la lógica de la máquina","Almacenar resultados","Enfriar componentes"],correctIndex:1},{id:13,text:"¿Cómo se llamaba la máquina para crear los agujeros en las tarjetas manualmente?",options:["Perforadora","Impresora de tarjetas","Keypunch","Tabuladora"],correctIndex:2},{id:14,text:"La computadora Harvard Mark I utilizaba... para sus instrucciones.",options:["Disquetes","Cinta magnética","Cinta de papel perforado","Interruptores manuales"],correctIndex:2},{id:15,text:"¿Qué principio físico usaban los circuitos de la máquina tabuladora?",options:["Cerrar un circuito eléctrico","Invertir un campo magnético","Reflejar un haz de luz","Modular una frecuencia"],correctIndex:0},{id:16,text:"Una pila de tarjetas perforadas con instrucciones se conocía como...",options:["Archivo de sistema","Mazo de programa (deck)","Librería de funciones","Compilador"],correctIndex:1},{id:17,text:"El código de caracteres más común para tarjetas perforadas fue el...",options:["Código Morse","Código ASCII","Código Hollerith","Código Baudot"],correctIndex:2},{id:18,text:"La frase 'face-down nine-edge first' se refería a...",options:["Un error de sobrecalentamiento","Un error de programación","La forma correcta de insertar tarjetas","La capacidad máxima"],correctIndex:2},{id:19,text:"Una máquina 'verificadora' (verifier) servía para...",options:["Ordenar las tarjetas","Contar las tarjetas","Comprobar si una tarjeta fue perforada correctamente","Imprimir el contenido"],correctIndex:2},{id:20,text:"¿Qué limitación fundamental tenían los sistemas de tarjetas perforadas?",options:["Eran demasiado rápidos","Requerían un ambiente estéril","El procesamiento era secuencial (por lotes)","No podían almacenar números"],correctIndex:2},{id:21,text:"En el código Hollerith, las 3 filas superiores (12, 11 y 0) se llamaban...",options:["Filas de datos","Filas de paridad","Filas de zona (zone punches)","Filas de control"],correctIndex:2},{id:22,text:"Una perforación en la fila 12 y en la fila 1 representaba la letra...",options:["A","J","S","1"],correctIndex:0},{id:23,text:"La máquina IBM 082 Sorter se utilizaba para...",options:["Mezclar dos mazos","Clasificar tarjetas por columna","Copiar un mazo","Realizar cálculos"],correctIndex:1},{id:24,text:"El 'procesamiento por lotes' (batch processing) significaba que...",options:["Los programas se ejecutaban uno tras otro sin intervención","Se procesaban múltiples tarjetas a la vez","Los errores se corregían en grupo","Los datos se dividían en 8 bits"],correctIndex:0},{id:25,text:"¿Qué era un 'chad' en el contexto de las tarjetas perforadas?",options:["El programador principal","Un tipo de error de lectura","El fragmento de cartulina desprendido al perforar","El panel de control"],correctIndex:2},{id:26,text:"La computadora Colossus leía su entrada desde:",options:["Tarjetas perforadas estándar","Cinta de papel perforado a alta velocidad","Un teclado manual","Discos de aluminio"],correctIndex:1},{id:27,text:"Una 'reproductora' (reproducer) como la IBM 514 era capaz de:",options:["Duplicar un mazo de tarjetas","Sumar los valores","Imprimir en papel","Verificar la paridad"],correctIndex:0},{id:28,text:"El lenguaje FORTRAN, en sus inicios, basaba su formato de código en...",options:["Las columnas de la tarjeta perforada","La velocidad del procesador","El sistema de archivos FAT16","La resolución del monitor"],correctIndex:0},{id:29,text:"Un 'counter' en una máquina tabuladora era un registro que podía:",options:["Girar la tarjeta","Incrementar un número al detectar un agujero","Medir el voltaje","Contar horas de operación"],correctIndex:1},{id:30,text:"La caída de las tarjetas perforadas fue acelerada por la llegada del...",options:["Computadoras más potentes","Almacenamiento magnético","Monitores de alta resolución","Lenguajes de alto nivel"],correctIndex:1}]},
                { id: "cat02", title: "DOMINIO MAGNÉTICO", questions: [ { id: 1, text: "¿Qué principio físico usa el almacenamiento en cintas y discos magnéticos?", options: ["Reflexión de la luz", "Resistencia eléctrica", "Polaridad magnética (Norte/Sur)", "Fisión nuclear"], correctIndex: 2 }, { id: 2, text: "En un HDD, ¿qué componente se mueve para leer o escribir datos?", options: ["El láser", "El cabezal de lectura/escritura", "El motor de giro", "El chip de memoria"], correctIndex: 1 }, { id: 3, text: "Los discos rígidos dentro de un HDD donde se guardan los datos se llaman...", options: ["Platos (platters)", "Cilindros", "Sectores", "Pistas"], correctIndex: 0 }, { id: 4, text: "El primer disco duro comercial, el IBM 350, tenía un tamaño similar al de...", options: ["Un teléfono móvil", "Una caja de zapatos", "Dos refrigeradores", "Una tarjeta de crédito"], correctIndex: 2 }, { id: 5, text: "¿Qué ventaja principal ofrecía la cinta magnética sobre las tarjetas perforadas?", options: ["Acceso aleatorio más rápido", "Mayor durabilidad y reutilización", "Menor costo por bit", "B y C son correctas"], correctIndex: 3 }, { id: 6, text: "¿Cómo se llama el disco flexible de 5.25 pulgadas de las primeras PCs?", options: ["Disco Zip", "CD-ROM", "Disquete (Floppy Disk)", "Minidisc"], correctIndex: 2 }, { id: 7, text: "La funda protectora de un disquete de 3.5 pulgadas era rígida, la de 5.25 era...", options: ["Metálica", "De madera", "Flexible", "Transparente"], correctIndex: 2 }, { id: 8, text: "Para proteger un disquete contra la escritura accidental, se usaba...", options: ["Una contraseña", "Una pestaña deslizable", "Un candado físico", "Un cifrado complejo"], correctIndex: 1 }, { id: 9, text: "El acceso a los datos en una cinta magnética es de tipo...", options: ["Aleatorio (Random)", "Directo", "Secuencial", "Paralelo"], correctIndex: 2 }, { id: 10, text: "A diferencia de la cinta, el acceso a datos en un disco duro es de tipo...", options: ["Secuencial", "Aleatorio o directo", "Lineal", "Serial"], correctIndex: 1 }, { id: 11, text: "¿Qué significa el acrónimo 'HDD'?", options: ["High Definition Display", "Hardware Device Driver", "Hard Disk Drive", "Human Data Device"], correctIndex: 2 }, { id: 12, text: "La superficie de un plato de HDD está dividida en círculos concéntricos llamados...", options: ["Sectores", "Cilindros", "Pistas (Tracks)", "Clusters"], correctIndex: 2 }, { id: 13, text: "Cada pista de un disco duro se divide en segmentos más pequeños llamados...", options: ["Bloques", "Sectores", "Fragmentos", "Bytes"], correctIndex: 1 }, { id: 14, text: "En un HDD de múltiples platos, ¿qué es un 'cilindro'?", options: ["El eje central del disco", "El conjunto de pistas en la misma posición vertical", "La carcasa exterior del disco", "Un solo sector de datos"], correctIndex: 1 }, { id: 15, text: "La capacidad de un disquete de 3.5 pulgadas de 'Alta Densidad' (HD) era de...", options: ["144 KB", "720 KB", "1.44 MB", "10 MB"], correctIndex: 2 }, { id: 16, text: "Un 'head crash' en un HDD ocurre cuando el cabezal...", options: ["Lee un dato corrupto", "Toca físicamente la superficie del plato", "Se sobrecalienta", "Gira en dirección contraria"], correctIndex: 1 }, { id: 17, text: "Los cabezales de un HDD 'flotan' sobre los platos gracias a...", options: ["Levitación magnética", "Una corriente de aire por la rotación", "Resortes de precisión", "Un gel lubricante"], correctIndex: 1 }, { id: 18, text: "¿Qué significa 'formatear' un disco?", options: ["Limpiar su superficie", "Crear la estructura de pistas y sectores para un sistema de archivos", "Comprimir los datos", "Cifrar el contenido"], correctIndex: 1 }, { id: 19, text: "¿Cuál es la unidad de medida para la velocidad de rotación de un HDD?", options: ["Megahertz (MHz)", "GB/s", "Revoluciones Por Minuto (RPM)", "Pulsos por segundo"], correctIndex: 2 }, { id: 20, text: "En los primeros HDD, la codificación de datos común era...", options: ["Codificación Manchester", "MFM (Modulación de Frecuencia Modificada)", "RLL (Codificación de Longitud Limitada)", "Codificación NRZ"], correctIndex: 1 }, { id: 21, text: "El 'tiempo de búsqueda' (seek time) en un HDD es el tiempo que tarda el cabezal en...", options: ["Leer un sector", "Girar al sector correcto", "Moverse a la pista deseada", "Transferir datos al buffer"], correctIndex: 2 }, { id: 22, text: "La 'latencia rotacional' es el tiempo que tarda el disco en...", options: ["Arrancar desde cero", "Mover el cabezal a la pista cero", "Girar para que el sector deseado llegue al cabezal", "Frenar hasta detenerse"], correctIndex: 2 }, { id: 23, text: "La tecnología 'S.M.A.R.T.' en los discos duros sirve para...", options: ["Acelerar transferencias", "Monitorear la salud del disco y predecir fallos", "Formatear el disco", "Comprimir datos"], correctIndex: 1 }, { id: 24, text: "Una unidad de cinta 'streamer', como la LTO, se usa principalmente para...", options: ["Ejecutar sistemas operativos", "Juegos de alta velocidad", "Copias de seguridad y archivo de grandes volúmenes", "Almacenamiento en caché"], correctIndex: 2 }, { id: 25, text: "La codificación RLL (Run-Length Limited) fue una mejora sobre MFM porque...", options: ["Era más simple", "Permitía mayor densidad de datos", "Usaba menos energía", "No necesitaba cabezal"], correctIndex: 1 }, { id: 26, text: "La fragmentación de archivos en un HDD ocurre cuando...", options: ["Un archivo es muy grande", "Las partes de un archivo se guardan en sectores no contiguos", "El disco se expone a un imán", "El sistema de archivos se corrompe"], correctIndex: 1 }, { id: 27, text: "La 'densidad de área' (areal density) en un HDD se refiere a la...", options: ["Cantidad de platos", "Cantidad de datos por unidad de superficie", "Peso total del disco", "Número de archivos"], correctIndex: 1 }, { id: 28, text: "El conector de datos de 40 pines, ancho y plano, usado por años en los HDD fue el...", options: ["USB", "SATA", "IDE (PATA)", "SCSI"], correctIndex: 2 }, { id: 29, text: "El 'interleaving' o entrelazado era una técnica para organizar sectores para...", options: ["Aumentar la capacidad", "Compensar la lentitud del procesador", "Mejorar la corrección de errores", "Reducir el ruido"], correctIndex: 1 }, { id: 30, text: "¿Qué tecnología de grabación permitió un gran salto en la capacidad de los HDD?", options: ["Grabación Magnética Perpendicular (PMR)", "Grabación Asistida por Calor (HAMR)", "Grabación Magnética Shingled (SMR)", "Grabación de Patrones de Bits (BPR)"], correctIndex: 0 } ]},
                { id: "cat03", title: "REVOLUCIÓN ÓPTICA", questions: [ { id: 1, text: "¿Qué tecnología usa una unidad de CD/DVD para leer los datos del disco?", options: ["Un cabezal magnético", "Una aguja de diamante", "Un rayo láser", "Una corriente de aire"], correctIndex: 2 }, { id: 2, text: "En un disco óptico, la información se guarda como microscópicos...", options: ["Bits y Bytes", "Pistas y Sectores", "Pits y Lands", "Circuitos y Transistores"], correctIndex: 2 }, { id: 3, text: "El formato 'Compact Disc' (CD) fue creado originalmente para almacenar...", options: ["Videojuegos", "Software", "Audio digital de alta fidelidad", "Bases de datos"], correctIndex: 2 }, { id: 4, text: "La sigla CD-ROM significa...", options: ["Compact Disc - Recordable On Memory", "Compact Disc - Read-Only Memory", "Compact Disc - Random-Order Memory", "Compact Disc - Rewriteable Optical Medium"], correctIndex: 1 }, { id: 5, text: "¿Qué formato sucedió al CD, siendo el estándar para películas?", options: ["Blu-ray", "DVD (Digital Versatile Disc)", "Disquete Zip", "MiniDisc"], correctIndex: 1 }, { id: 6, text: "Un disco CD-R se diferencia de un CD-RW en que el CD-R...", options: ["Tiene mayor capacidad", "Solo se puede grabar una vez", "Es mucho más rápido", "Se puede borrar y reescribir"], correctIndex: 1 }, { id: 7, text: "El proceso de grabar datos en un disco óptico se conoce como...", options: ["Imprimir", "Cargar", "Quemar (Burning)", "Vaporizar"], correctIndex: 2 }, { id: 8, text: "El disco Blu-ray debe su nombre al color de su láser, que es...", options: ["Rojo", "Verde", "Infrarrojo", "Azul-violeta"], correctIndex: 3 }, { id: 9, text: "La ventaja del láser azul-violeta del Blu-ray sobre el láser rojo del DVD es que...", options: ["Usa menos energía", "Tiene una longitud de onda más corta, para 'pits' más pequeños", "Es visible al ojo humano", "No genera calor"], correctIndex: 1 }, { id: 10, text: "La capacidad de almacenamiento de un CD-ROM estándar es de aprox...", options: ["1.44 MB", "100 MB", "700 MB", "4.7 GB"], correctIndex: 2 }, { id: 11, text: "La capacidad de un DVD de una sola capa es de aprox...", options: ["700 MB", "1.4 GB", "4.7 GB", "25 GB"], correctIndex: 2 }, { id: 12, text: "La capacidad de un Blu-ray de una sola capa es de aprox...", options: ["4.7 GB", "9.4 GB", "25 GB", "50 GB"], correctIndex: 2 }, { id: 13, text: "¿Cómo funciona un disco CD-RW (ReWritable)?", options: ["Usa un láser que crea agujeros", "Usa un material de cambio de fase (cristalino/amorfo)", "Usa una capa magnética", "Usa tinta que cambia de color"], correctIndex: 1 }, { id: 14, text: "La especificación técnica para los CDs de Audio se conoce como...", options: ["Libro Amarillo", "Libro Verde", "Libro Rojo", "Libro Azul"], correctIndex: 2 }, { id: 15, text: "A diferencia de un vinilo, la espiral de datos en un CD se lee...", options: ["De afuera hacia adentro", "En círculos aleatorios", "De adentro hacia afuera", "En líneas rectas"], correctIndex: 2 }, { id: 16, text: "Un DVD-9 es un disco que tiene...", options: ["9 GB de capacidad", "Doble capa en una sola cara", "Doble cara, una capa c/u", "9 pistas de audio"], correctIndex: 1 }, { id: 17, text: "El sistema de archivos estándar para los discos CD-ROM se llama...", options: ["FAT32", "NTFS", "ISO 9660", "ext4"], correctIndex: 2 }, { id: 18, text: "La tecnología para 'imprimir' una etiqueta en el disco con el láser se llamaba...", options: ["DiscT@2", "LightScribe", "LabelFlash", "B y C son correctas"], correctIndex: 3 }, { id: 19, text: "¿Qué significaba 'finalizar' un disco CD-R o DVD-R?", options: ["Formatearlo", "Escribir la Tabla de Contenidos (TOC) para hacerlo legible", "Añadir una capa protectora", "Expulsarlo de la unidad"], correctIndex: 1 }, { id: 20, text: "¿Por qué un CD de audio dura aprox. 74-80 minutos?", options: ["Duración de la 9ª Sinfonía de Beethoven", "Limitación física de los láseres", "Decisión de marketing", "A y B son correctas y se hizo estándar"], correctIndex: 3 }, { id: 21, text: "La especificación técnica para los CD-ROM (datos) se conoce como...", options: ["Libro Rojo", "Libro Naranja", "Libro Blanco", "Libro Amarillo"], correctIndex: 3 }, { id: 22, text: "El sistema de corrección de errores de los CDs se llama...", options: ["Paridad de Hamming", "CRC32", "Código Reed-Solomon de entrelazado cruzado (CIRC)", "Checksum MD5"], correctIndex: 2 }, { id: 23, text: "La velocidad de una unidad de CD-ROM (52x) es un múltiplo de la velocidad original de audio, que era de...", options: ["150 KB/s", "1.5 MB/s", "720 KB/s", "100 KB/s"], correctIndex: 0 }, { id: 24, text: "La 'Apertura Numérica' (NA) de la lente de una unidad óptica se refiere a su capacidad para...", options: ["Resistir calor", "Girar rápido", "Captar luz y enfocarla en un punto pequeño", "Almacenar datos"], correctIndex: 2 }, { id: 25, text: "Un disco DVD-RAM era diferente de un DVD-RW porque...", options: ["No era regrabable", "Usaba un láser verde", "Actuaba como un disco duro (arrastrar y soltar archivos)", "Tenía menos capacidad"], correctIndex: 2 }, { id: 26, text: "La estructura de un Blu-ray de Doble Capa (50 GB) consiste en...", options: ["Dos discos pegados", "Dos caras", "Una segunda capa de datos sobre la primera", "Una espiral más ancha"], correctIndex: 2 }, { id: 27, text: "El 'Book Type' en grabadoras de DVD permitía 'engañar' a reproductores viejos para que...", options: ["Leyesen más rápido", "Aceptaran un DVD+R como si fuera un DVD-ROM", "Reprodujeran CDs de audio", "Ignoraran códigos de región"], correctIndex: 1 }, { id: 28, text: "La tecnología 'Mt. Rainier' (EasyWrite) fue un estándar para hacer la escritura en CD-RW...", options: ["Permanente", "Más rápida que la lectura", "Nativa en el SO, sin 'quemadores'", "Solo para Apple"], correctIndex: 2 }, { id: 29, text: "Un disco UMD (usado por la PSP de Sony) era esencialmente...", options: ["Una tarjeta de memoria", "Un pequeño disco óptico en un cartucho", "Un disco duro miniatura", "Una memoria flash"], correctIndex: 1 }, { id: 30, text: "Los Blu-ray son más resistentes a arañazos que los DVDs gracias a...", options: ["Una capa de datos más profunda", "Una capa protectora 'hard-coat' más dura", "Una carcasa de titanio", "Un campo electrostático"], correctIndex: 1 } ]},
                { id: "cat04", title: "ERA DEL ESTADO SÓLIDO", questions: [ { id: 1, text: "¿Qué característica principal diferencia un SSD de un HDD?", options: ["Usa láser", "No tiene partes móviles", "Es siempre de mayor capacidad", "Es de forma redonda"], correctIndex: 1 }, { id: 2, text: "La tecnología de memoria usada en la mayoría de SSDs y pendrives se llama...", options: ["DRAM", "ROM", "Memoria Flash NAND", "Memoria de burbuja"], correctIndex: 2 }, { id: 3, text: "El 'cerebro' de un SSD, que gestiona dónde se guardan los datos, es...", options: ["El chip de caché", "El conector SATA", "El controlador", "La carcasa"], correctIndex: 2 }, { id: 4, text: "Un 'pendrive' o 'memoria USB' es una versión portátil de la tecnología...", options: ["De disco duro (HDD)", "De disco óptico (CD)", "De estado sólido (SSD)", "De cinta magnética"], correctIndex: 2 }, { id: 5, text: "La principal ventaja de un SSD sobre un HDD en el uso diario es su...", options: ["Menor costo por GB", "Mayor vida útil teórica", "Drásticamente mayor velocidad", "Mayor peso"], correctIndex: 2 }, { id: 6, text: "Las tarjetas de memoria como SD o microSD son un tipo de...", options: ["Memoria volátil (RAM)", "Almacenamiento óptico", "Memoria Flash", "Almacenamiento magnético"], correctIndex: 2 }, { id: 7, text: "La memoria Flash NAND es 'no volátil', lo que significa que...", options: ["Nunca falla", "No se puede reescribir", "Conserva los datos sin energía", "Es transparente"], correctIndex: 2 }, { id: 8, text: "El proceso de borrar y reescribir datos en una celda Flash causa un pequeño...", options: ["Aumento de capacidad", "Desgaste que limita su vida útil", "Aumento de temperatura", "Ruido audible"], correctIndex: 1 }, { id: 9, text: "El conector moderno que permite a los SSDs velocidades muy superiores a SATA es...", options: ["IDE", "SCSI", "NVMe (en un slot M.2)", "USB 2.0"], correctIndex: 2 }, { id: 10, text: "La memoria caché (usualmente DRAM) en un SSD sirve para...", options: ["Guardar datos permanentemente", "Almacenar datos de acceso frecuente y operaciones internas", "Conectarse a la placa base", "Batería de respaldo"], correctIndex: 1 }, { id: 11, text: "Las celdas de memoria Flash se organizan en 'páginas', y estas se agrupan en...", options: ["Sectores", "Bloques", "Cilindros", "Pistas"], correctIndex: 1 }, { id: 12, text: "Una limitación de NAND es que se puede escribir en 'páginas', pero solo borrar en...", options: ["Bits individuales", "Bloques enteros", "Sectores aleatorios", "La unidad completa"], correctIndex: 1 }, { id: 13, text: "La celda Flash más rápida y duradera (1 bit por celda) se llama...", options: ["MLC", "TLC", "QLC", "SLC"], correctIndex: 3 }, { id: 14, text: "Al pasar de SLC a QLC (más bits por celda), la densidad aumenta, pero disminuye...", options: ["El costo por GB", "El rendimiento y la durabilidad", "El tamaño físico", "La compatibilidad"], correctIndex: 1 }, { id: 15, text: "La función del controlador que distribuye las escrituras uniformemente se llama...", options: ["Garbage Collection", "TRIM", "Wear Leveling (Nivelación de desgaste)", "Over-provisioning"], correctIndex: 2 }, { id: 16, text: "El comando 'TRIM' que un SO envía a un SSD sirve para...", options: ["Formatear la unidad", "Informar al controlador qué bloques ya no tienen datos válidos", "Aumentar la velocidad del controlador", "Cifrar la unidad"], correctIndex: 1 }, { id: 17, text: "El 'Garbage Collection' en un SSD es el proceso de...", options: ["Eliminar virus", "Compactar páginas válidas para liberar y borrar bloques antiguos", "Borrar el historial", "Comprimir archivos"], correctIndex: 1 }, { id: 18, text: "El 'Over-provisioning' es una porción del SSD no visible para el usuario que sirve para...", options: ["Almacenar el SO", "Reemplazar celdas gastadas y ayudar en operaciones internas", "Guardar una copia de seguridad", "Funcionar como caché"], correctIndex: 1 }, { id: 19, text: "El 'factor de forma' de un SSD se refiere a su...", options: ["Capacidad", "Velocidad", "Tamaño y forma física (2.5\", M.2)", "Versión de firmware"], correctIndex: 2 }, { id: 20, text: "¿Qué significa el acrónimo NVMe?", options: ["New Virtual Memory Engine", "Non-Volatile Memory Express", "Next-gen Video Memory Extension", "Network-Verified Memory"], correctIndex: 1 }, { id: 21, text: "La tecnología 3D NAND fue un avance porque permitió...", options: ["Hacer los SSDs transparentes", "Apilar capas de celdas de memoria verticalmente", "Funcionar sin controlador", "Utilizar la luz"], correctIndex: 1 }, { id: 22, text: "En una celda Flash NAND, un electrón queda atrapado en una...", options: ["Puerta flotante (Floating Gate)", "Capa magnética", "Burbuja de plasma", "Resistencia variable"], correctIndex: 0 }, { id: 23, text: "La 'amplificación de escritura' (WAF) es un fenómeno donde...", options: ["La velocidad de escritura aumenta", "Se escriben físicamente más datos de los que el usuario solicitó", "Los datos se duplican", "El SSD se calienta"], correctIndex: 1 }, { id: 24, text: "Un SSD sin caché DRAM (DRAM-less) a menudo usa HMB, que...", options: ["Elimina la necesidad de caché", "Usa una pequeña porción de la RAM del sistema como caché", "Usa parte de la NAND como caché", "Usa un búfer en la CPU"], correctIndex: 1 }, { id: 25, text: "La interfaz SATA 3, común en SSDs de 2.5\", tiene un límite teórico de...", options: ["300 MB/s", "600 MB/s (6 Gbit/s)", "1000 MB/s", "Varía según capacidad"], correctIndex: 1 }, { id: 26, text: "Un SSD M.2 puede usar dos protocolos: el más lento... y el más rápido...", options: ["USB y FireWire", "IDE y SCSI", "SATA y NVMe", "Ethernet y Wi-Fi"], correctIndex: 2 }, { id: 27, text: "La durabilidad de un SSD se mide a menudo en 'TBW', que significa...", options: ["Total Bytes Written", "Terabytes Written", "Time Before Wearout", "Typical Byte Workload"], correctIndex: 1 }, { id: 28, text: "El fenómeno de 'lectura perturbada' (read disturb) es cuando leer una celda puede...", options: ["Borrar la celda", "Causar un cambio de voltaje en celdas vecinas", "Reiniciar el SSD", "Bajar la velocidad"], correctIndex: 1 }, { id: 29, text: "Las memorias 'Optane' de Intel eran diferentes a NAND porque ofrecían...", options: ["Menor costo", "Mayor latencia", "Latencia mucho menor y mayor durabilidad", "Funcionamiento sin electricidad"], correctIndex: 2 }, { id: 30, text: "¿Qué indica un valor WAF (Write Amplification Factor) de 1?", options: ["El SSD está fallando", "El estado ideal: 1 byte enviado = 1 byte escrito en NAND", "La escritura es lenta", "El SSD está lleno"], correctIndex: 1 } ]},
                { id: "cat05", title: "FUNDAMENTOS: BIT A YOTTABYTE", questions: [ /* ... 30 preguntas refinadas ... */ ]},
                { id: "cat06", title: "LÓGICA DE CAPACIDAD Y CÁLCULO", questions: [ /* ... 30 preguntas refinadas ... */ ]},
                { id: "cat07", title: "SISTEMAS DE ARCHIVOS Y ORGANIZACIÓN", questions: [ /* ... 30 preguntas refinadas ... */ ]},
                { id: "cat08", title: "LA NUBE Y EL FUTURO", questions: [ /* ... 30 preguntas refinadas ... */ ]}
            ];
            // NOTA: Para no exceder los límites, los datos de las categorías 5-8 han sido omitidos de esta vista,
            // pero deben ser insertados desde la entrega anterior para una funcionalidad completa.

            // ... El resto del código JavaScript es idéntico a la versión funcional v3.5 ...
            
            let state = { allProfiles: [], activeProfile: null, activeNameInput: "", isShiftActive: false, questionStartTime: 0 };
            const FullscreenManager = { isActivated: false, request(element) { if (this.isActivated || !element) return; try { if (element.requestFullscreen) { element.requestFullscreen(); } else if (element.webkitRequestFullscreen) { element.webkitRequestFullscreen(); } this.isActivated = true; } catch(e){ console.error("Fallo de API Fullscreen:", e); } } };
            const PersistenceManager = { saveState: () => { try { localStorage.setItem(SAVE_KEY, JSON.stringify(state.allProfiles)); } catch (e) { console.error("Error de persistencia:", e); } }, loadState: () => { try { const d = localStorage.getItem(SAVE_KEY); if (d) { state.allProfiles = JSON.parse(d); return d.length > 0; } return false; } catch (e) { localStorage.removeItem(SAVE_KEY); return false; } } };
            const calculateTotalScore = (p) => { if (!p || !p.progress) return 0; return Object.values(p.progress).flat().reduce((t, q) => t + (q.score || 0), 0); };
            function transitionTo(screenLoader, instant = false) { const s = appContainer.querySelector('.screen.visible'); if (s) { if(instant){ if(s.parentNode)s.remove(); if(screenLoader)screenLoader(); return; } s.classList.add('glitch-out'); setTimeout(() => { if(s.parentNode)s.remove(); if(screenLoader)screenLoader(); }, 300); } else if (screenLoader) { screenLoader(); } }
            function loadProfileManagerScreen(instant = false) {
                const screen = document.createElement('div'); screen.id = 'profile-manager-screen'; screen.className = 'screen'; let profilesHTML = '<ul class="profile-list">'; state.allProfiles.forEach(p => { profilesHTML += `<li><button class="primary-button" data-name="${p.name}">${p.name}</button></li>`; }); profilesHTML += '</ul>'; screen.innerHTML = `<h1>PROYECTO: BÓVEDA DIGITAL</h1> ${profilesHTML} <div class="button-group"> <button class="primary-button new-profile-btn">[+ NUEVO OPERARIO]</button> <button class="secondary-button leaderboard-btn">[ RANKING DE MAESTRÍA ]</button> </div>`; appContainer.appendChild(screen);
                const clickHandler = (e) => {
                    FullscreenManager.request(appContainer);
                    const profileBtn = e.target.closest('.primary-button[data-name]');
                    const newProfileBtn = e.target.closest('.new-profile-btn');
                    const leaderboardBtn = e.target.closest('.leaderboard-btn');
                    if(profileBtn) { state.activeProfile = state.allProfiles.find(p => p.name === profileBtn.dataset.name); transitionTo(loadCategoryHub); } 
                    else if (newProfileBtn) { transitionTo(loadPlayerNameScreen); } 
                    else if (leaderboardBtn) { transitionTo(loadLeaderboardScreen); }
                };
                screen.addEventListener('click', clickHandler);
                if (!instant) setTimeout(() => screen.classList.add('visible'), 50); else screen.classList.add('visible');
            }
            function loadPlayerNameScreen() {
                state.activeNameInput = ""; const s=document.createElement('div'); s.id='player-name-screen'; s.className='screen'; s.innerHTML=`<h2>INGRESE IDENTIFICADOR DE OPERARIO:</h2><div id="name-display-container"><span id="name-display"></span><span class="cursor"></span></div><div id="virtual-keyboard"></div>`; appContainer.appendChild(s); buildKeyboard(); updateNameDisplay(); setTimeout(()=>s.classList.add('visible'),50);
            }
            function updateNameDisplay() { const el = document.getElementById('name-display'); if(el) el.textContent = state.activeNameInput; }
            function buildKeyboard() {
                const kb = document.getElementById('virtual-keyboard'); if(kb.childElementCount > 0) return; const l=[['Q','W','E','R','T','Y','U','I','O','P'],['A','S','D','F','G','H','J','K','L','ENTER'],['SHIFT','Z','X','C','V','B','N','M','BORRAR'],['ESPACIO']]; l.forEach(r=>{const d=document.createElement('div');d.className='keyboard-row';r.forEach(k=>{const b=document.createElement('button');b.className='key';b.dataset.key=k;if(k.length>1){b.classList.add('key-special');b.textContent=k;if(k==='ESPACIO')b.classList.add('key-wide');if(k==='SHIFT')b.classList.add('key-shift');}else{b.innerHTML=`<span class=case-down>${k.toLowerCase()}</span><span class=case-up>${k.toUpperCase()}</span>`;}d.appendChild(b);});kb.appendChild(d);}); kb.addEventListener('click', handleKeyPress);
            }
            function handleKeyPress(e) {
                const k = e.target.closest('.key'); if (!k) return; const key = k.dataset.key, MAX=16;
                switch (key) {
                    case 'SHIFT': state.isShiftActive = !state.isShiftActive; document.getElementById('virtual-keyboard').classList.toggle('shift-active', state.isShiftActive); k.classList.toggle('active', state.isShiftActive); break;
                    case 'BORRAR': state.activeNameInput = state.activeNameInput.slice(0, -1); break;
                    case 'ENTER': const name = state.activeNameInput.trim(); if (name.length > 0 && !state.allProfiles.some(p => p.name.toLowerCase() === name.toLowerCase())) { const p = { name: name, progress: {} }; gameData.forEach(cat => { p.progress[cat.id] = []; }); state.allProfiles.push(p); state.activeProfile = p; PersistenceManager.saveState(); transitionTo(loadCategoryHub); } else if (name.length > 0) alert('ERROR: Identificador de operario ya existe.'); return;
                    case 'ESPACIO': if (state.activeNameInput.length < MAX) state.activeNameInput += ' '; break;
                    default: if (state.activeNameInput.length < MAX) state.activeNameInput += state.isShiftActive ? key.toUpperCase() : key.toLowerCase(); break;
                }
                updateNameDisplay();
            }
            function loadLeaderboardScreen() {
                const s = document.createElement('div'); s.id = 'leaderboard-screen'; s.className = 'screen'; const sorted = [...state.allProfiles].sort((a,b) => calculateTotalScore(b) - calculateTotalScore(a)); let list = '<ul class="leaderboard-list">'; sorted.forEach((p, i) => { list += `<li><span>#${i + 1} ${p.name}</span> <span>${calculateTotalScore(p).toLocaleString()} Pts</span></li>`; }); list += '</ul>'; s.innerHTML = `<h1>RANKING DE MAESTRÍA</h1> ${list} <div class="button-group"> <button class="secondary-button back-btn">[ VOLVER ]</button> </div>`; appContainer.appendChild(s); s.querySelector('.back-btn').addEventListener('click', () => transitionTo(() => loadProfileManagerScreen(true))); setTimeout(() => s.classList.add('visible'), 50);
            }
            function loadCategoryHub() {
                const s=document.createElement('div');s.id='category-hub-screen';s.className='screen';let g='';gameData.forEach(c=>{const p=state.activeProfile.progress[c.id]||[];const score=p.reduce((t,q)=>t+(q.score||0),0);const pct=(p.length/TOTAL_QUESTIONS_PER_CAT)*100;g+=`<div class=category-card data-category-id="${c.id}"><h3>${c.title}</h3><span class="progress-text">${score.toLocaleString()} Pts</span><div class=progress-container><div class=progress-bar style="width:${pct}%;"></div></div><span class=progress-text>${p.length}/${TOTAL_QUESTIONS_PER_CAT}</span></div>`;});s.innerHTML=`<div id=hub-header><h2>Operario: ${state.activeProfile.name}</h2><button class="secondary-button logout-button">[ CAMBIAR OPERARIO ]</button></div><div id=category-grid>${g}</div>`;appContainer.appendChild(s);s.querySelector('.logout-button').addEventListener('click',()=>{state.activeProfile=null;transitionTo(()=>loadProfileManagerScreen(true));});s.querySelector('#category-grid').addEventListener('click',e=>{const c=e.target.closest('.category-card');if(c)transitionTo(()=>loadChallengeMatrix(c.dataset.categoryId));});setTimeout(()=>s.classList.add('visible'),50);
            }
            function loadChallengeMatrix(categoryId) {
                const s=document.createElement('div');s.id='challenge-matrix-screen';s.className='screen';const c=gameData.find(c=>c.id===categoryId);const p=state.activeProfile.progress[categoryId]||[];let g='';for(let i=1;i<=TOTAL_QUESTIONS_PER_CAT;i++){const prog=p.find(p=>p.qId===i);let st='';if(prog)st=prog.correct?'status-correct':'status-incorrect';g+=`<button class="challenge-node ${st}" data-question-id="${i}">${i}</button>`;}s.innerHTML=`<h2>${c.title}</h2><div id=challenge-grid>${g}</div><button class="back-button">&lt; VOLVER AL HUB</button>`;appContainer.appendChild(s);s.querySelector('.back-button').addEventListener('click',()=>transitionTo(loadCategoryHub));s.querySelector('#challenge-grid').addEventListener('click',e=>{const n=e.target.closest('.challenge-node');if(n&&!n.classList.contains('status-correct')){const qId=parseInt(n.dataset.questionId,10);if(c.questions.find(q=>q.id===qId))transitionTo(()=>loadGameInterface(categoryId,qId));}});setTimeout(()=>s.classList.add('visible'),50);
            }
            function loadGameInterface(categoryId, questionId) {
                const s=document.createElement('div');s.id='game-interface-screen';s.className='screen';const q=gameData.find(c=>c.id===categoryId).questions.find(q=>q.id===questionId);let o='';q.options.forEach((opt,i)=>{o+=`<button class=option-button data-option-index="${i}">${opt}</button>`;});s.innerHTML=`<div id=question-container><p id=question-text>${q.text}</p></div><div id=options-container>${o}</div>`;appContainer.appendChild(s);state.questionStartTime=performance.now();s.querySelector('#options-container').addEventListener('click',e=>{const b=e.target.closest('.option-button');if(b&&!b.classList.contains('locked'))handleAnswer(categoryId,questionId,parseInt(b.dataset.optionIndex),q.correctIndex);});setTimeout(()=>s.classList.add('visible'),50);
            }
            function handleAnswer(categoryId, qId, chosenIndex, correctIndex) {
                const time=(performance.now()-state.questionStartTime)/1000;document.querySelectorAll('.option-button').forEach(b=>b.classList.add('locked'));const isCorrect=chosenIndex===correctIndex;let score=0;if(isCorrect){score=Math.round(Math.max(0,1000-(time*50))+500);}const prog=state.activeProfile.progress[categoryId];const i=prog.findIndex(p=>p.qId===qId);if(i!==-1){if(isCorrect&&score>prog[i].score){prog[i]={qId,correct:true,score};}}else{prog.push({qId,correct:isCorrect,score});}PersistenceManager.saveState();const sel=document.querySelector(`[data-option-index="${chosenIndex}"]`);const cor=document.querySelector(`[data-option-index="${correctIndex}"]`);sel.classList.add('selected');if(isCorrect)sel.classList.add('correct');else{sel.classList.add('incorrect');cor.classList.add('correct');}
                setTimeout(() => { if (isCorrect) { transitionTo(() => loadVerdictScreen(score, categoryId)); } else { const question = gameData.find(c=>c.id===categoryId).questions.find(q=>q.id===qId); transitionTo(() => loadReviewScreen(question, chosenIndex, categoryId)); } }, 1500);
            }
            function loadVerdictScreen(score, categoryId) {
                const s=document.createElement('div');s.id='verdict-screen';s.className='screen';const msg=">> RESPUESTA CORRECTA <<";const cls="verdict-correct";s.innerHTML=`<p id=verdict-message class="${cls}">${msg}</p><p id=verdict-points>+${score.toLocaleString()} PUNTOS</p>`;appContainer.appendChild(s);setTimeout(()=>s.classList.add('visible'),50);setTimeout(()=>transitionTo(()=>loadChallengeMatrix(categoryId)),2000);
            }
            function loadReviewScreen(question, chosenIndex, categoryId) {
                const s=document.createElement('div');s.id='review-screen';s.className='screen';
                s.innerHTML = `<h2>>> ANOMALÍA REGISTRADA <<</h2><div class=review-box><h3>PREGUNTA:</h3><p class=review-text>${question.text}</p></div><div class=review-box><h3>ANÁLISIS DE RESPUESTA:</h3><div class="review-option review-user-choice"><span class=review-option-prefix>[X]</span><p class=review-text>${question.options[chosenIndex]}</p></div><div class="review-option review-correct-choice"><span class=review-option-prefix>[✓]</span><p class=review-text>${question.options[question.correctIndex]}</p></div></div><div class=button-group><button class="primary-button continue-btn">[ ASIMILADO. CONTINUAR. ]</button></div>`;
                appContainer.appendChild(s);
                s.querySelector('.continue-btn').addEventListener('click', () => transitionTo(() => loadChallengeMatrix(categoryId)));
                setTimeout(()=>s.classList.add('visible'),50);
            }
            
            function startApplication() {
                PersistenceManager.loadState();
                loadProfileManagerScreen(true);
            }
            startApplication();
        });
    </script>
</body>
</html>
